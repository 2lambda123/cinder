<!DOCTYPE html>
<!-- Copyright (c) Facebook, Inc. and its affiliates. (http://www.facebook.com) -->
<html>
  <head>
    <title>Cinder Explorer</title>
    <style>
      body {
        margin: 0;
      }
      #main-box {
        height: 100vh;
        overflow: auto;
      }
      #input-box {
        padding: 10px;
        background: rgba(255,252,221,.81);
        overflow: hidden;
      }
      #results {
        width: 100%;
        height: 100%;
        border-top-width: 0px;
        border-right-width: 0px;
        border-bottom-width: 0px;
        border-left-width: 0px;
      }
      .split {
        display: flex;
        flex-direction: row;
      }
      .gutter {
        background-color: #eee;
        background-repeat: no-repeat;
        background-position: 50%;
      }
      .gutter.gutter-horizontal {
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
        cursor: col-resize;
      }
    </style>
    <link rel="stylesheet" href="vendor/highlight.min.css">
    <script src="vendor/split.min.js"></script>
    <script src="vendor/underscore.min.js"></script>
    <script src="vendor/highlight.min.js"></script>
    <script type="module">
      import Yace from "./vendor/yace.min.js";
      function loadSavedCode() {
        const code = window.localStorage.getItem('code');
        if (code === null) {
          return document.querySelector('#code').innerHTML;
        }
        return code;
      }
      function storeSavedCode(code) {
        window.localStorage.setItem('code', code);
      }
      function updateFormField(code) {
        document.querySelector('#code').innerHTML = code;
      }
      window.onload = function() {
        Split(['#input-box', '#results-box'], {
          sizes: [30, 70],
        });
        const code = loadSavedCode();
        updateFormField(code);
        document.querySelector('#explorer').submit();
        function highlighter(value) {
          return hljs.highlight(value, {language: "python"}).value;
        }
        const editor = new Yace("#editor", {
          value: code,
          lineNumbers: true,
          highlighter: highlighter,
        });
        editor.textarea.spellcheck = false;
        const submitForm = function() {
          document.querySelector('#explorer').submit();
        };
        const setCode = debounce(function(value) {
          storeSavedCode(value);
          updateFormField(value);
          submitForm();
        }, 500 /* ms */);
        editor.onUpdate(setCode);
        document.querySelector('#passes').addEventListener("change", submitForm);
      };
    </script>
  </head>
  <body>
    <div id="main-box" class="split">
      <div id="input-box">
        <h2>Cinder Explorer</h2>
        <p>Please see the <a href="https://github.com/facebookincubator/cinder">GitHub repo</a> for more information.</p>
        <form id="explorer" method="POST" action="/compile" target="results">
          <label for="passes">Select the passes you would like to see:</label>
          <br />
          <select id="passes" name="passes" multiple>
            <option>Source</option>
            <option>Bytecode</option>
            <option>SSAify</option>
            <option>Simplify</option>
            <option>DynamicComparisonElimination</option>
            <option>GuardTypeRemoval</option>
            <option>CallOptimization</option>
            <option>PhiElimination</option>
            <option>InlineFunctionCalls</option>
            <option>DeadCodeElimination</option>
            <option>RefcountInsertion</option>
            <option>Initial LIR</option>
            <option>Register-allocated LIR</option>
            <option selected>Assembly</option>
          </select>
          <br />
          <br />
          <label for="code">Put some Python in the box. Currently only one
            function is supported.</label>
          <br />
          <div id="editor"></div>
          <textarea id="code" name="code" style="display: none;">
a = 1

def foo():
  return a</textarea>
        </form>
      </div>
      <div id="results-box">
        <iframe id="results" name="results" src="/compile" frameborder="0"></iframe>
      </div>
    </div>
  </body>
</html>
<!-- Generated by @VERSION@ -->
